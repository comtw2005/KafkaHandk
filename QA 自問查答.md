7、Zookeeper 对于 Kafka 的作用是什么？

Zookeeper 是一个开放源码的、高性能的协调服务，它用于 Kafka 的分布式应用。
Zookeeper 主要用于在集群中不同节点之间进行通信
在 Kafka 中，它被用于提交偏移量，因此如果节点在任何情况下都失败了，它都可以从之前提交的偏移量中获取除此之外，它还执行其他活动，如: leader 检测、分布式同步、配置管理、识别新节点何时离开或连接、集群、节点实时状态等等。


10、Kafka 与传统 MQ 消息系统之间有三个关键区别

(1).Kafka 持久化日志，这些日志可以被重复读取和无限期保留
(2).Kafka 是一个分布式系统：它以集群的方式运行，可以灵活伸缩，在内部通过复制数据提升容错能力和高可用性
(3).Kafka 支持实时的流式处理

11、讲一讲 kafka 的 ack 的三种机制

request.required.acks 有三个值 0 1 -1(all)
0:生产者不会等待 broker 的 ack，这个延迟最低但是存储的保证最弱当 server 挂掉的时候就会丢数据。
1：服务端会等待 ack 值 leader 副本确认接收到消息后发送 ack 但是如果 leader挂掉后他不确保是否复制完成新 leader 也会导致数据丢失。
-1(all)：服务端会等所有的 follower 的副本受到数据后才会受到 leader 发出的ack，这样数据不会丢失

15、kafka 分布式（不是单机）的情况下，如何保证消息的顺序消费?

Kafka 分布式的单位是 partition，同一个 partition 用一个 write ahead log 组织，所以可以保证 FIFO 的顺序。不同 partition 之间不能保证顺序。但是绝大多数用户都可以通过 message key 来定义，因为同一个 key 的 message 可以保证只发送到同一个 partition。
Kafka 中发送 1 条消息的时候，可以指定(topic, partition, key) 3 个参数。partiton 和 key 是可选的。如果你指定了 partition，那就是所有消息发往同 1个 partition，就是有序的。并且在消费端，Kafka 保证，1 个 partition 只能被1 个 consumer 消费。或者你指定 key（ 比如 order id），具有同 1 个 key 的所有消息，会发往同 1 个 partition。

流平台具有三个关键功能：

    消息队列：发布和订阅消息流，这个功能类似于消息队列，这也是 Kafka 也被归类为消息队列的原因。
    容错的持久方式存储记录消息流： Kafka 会把消息持久化到磁盘，有效避免了消息丢失的风险·。
    流式处理平台： 在消息发布的时候进行处理，Kafka 提供了一个完整的流式处理类库。


Kafka 如何保证消息的消费顺序
Kafka 如何保证消息不丢失

* 為什麼要有topic
主题（Topic）是一個非常重要的概念，它具有多種用途並提供了以下幾個重要好處：
1. 數據組織和隔離：主題允許將消息組織成特定的數據集合，這樣相關的消息可以根據主題進行分組。每個主題都代表一個特定類型的數據，這使得消息更容易管理和尋找。同時，主題可以用於隔離不同應用程序或用戶的消息，確保數據的隔離性。

2. 多消費者和多生產者：主題支持多個消費者和多個生產者。這意味著一個主題的消息可以被多個消費者訂閱，並且多個生產者可以將消息發布到同一個主題。這種多對多的架構允許數據的多方共享和流動。

3. 持久性和歷史數據：Kafka 主題中的消息具有持久性，它們不會在消費後立即刪除。這允許主題作為數據的長期存儲庫，並允許消費者在需要時回溯並檢索過去的消息。這在許多場景中都非常有用，如數據分析、日誌存儲和數據備份。

4. 消息分發和負載均衡：主題允許消息被分發到多個分區，並且每個分區可以由不同的消費者進行訂閱。這允許 Kafka 在不同的消費者之間實現消息的負載均衡，確保消息有效地傳遞給消費者。

5. 擴展性：主題可以擴展，並且分區可以分佈到多個伺服器上。這使得 Kafka 能夠處理大規模數據流，而不會受到性能限制。

總之，主題在 Kafka 中是一個關鍵元素，它提供了組織、隔離、分發和持久性消息的機制，並允許多個消費者和生產者之間有效地交換數據。主題的使用使得 Kafka 成為一個強大的消息系統，適用於各種不同的應用場景，包括日誌處理、事件驅動應用、流處理和大數據分析。

* 為什麼要有partition

1. 橫向擴展和並行處理：分區允許 Kafka 集群水平擴展，將主題中的消息分散到多個分區中。這意味著每個分區都可以在不同的 Kafka 伺服器上獨立運行，實現並行處理。這對於實現高吞吐量和大規模數據流非常重要，因為它允許 Kafka 集群同時處理多個分區的消息，提高性能和擴展性。

2. 消息的順序性：在每個分區內，消息是有序的。這意味著如果消息需要按照特定的順序進行處理，您可以將相關的消息放入同一個分區，Kafka 會確保分區內的消息按照它們進入分區的順序進行處理。不同分區之間的消息順序不保證，但在同一分區內的消息是有序的。

3. 容錯性和可用性：分區的使用使 Kafka 具備了容錯性和可用性。如果一個 Kafka 伺服器失敗，其他伺服器上的分區仍然可以繼續運作，確保消息不會丟失。這對於構建高可用性的消息處理系統非常重要。

4. 並行消費者：分區允許多個消費者並行地處理主題中的消息。每個消費者可以訂閱一個或多個分區，這使得 Kafka 可以同時服務多個消費者，並允許您橫向擴展應用程式以提高吞吐量。
   
5. 消息保留策略：Kafka 允許您為每個分區配置不同的消息保留策略。這意味著您可以根據業務需求和數據的生命週期，為不同分區設置不同的消息保留期限。

總之，分區在 Kafka 中是一個關鍵的設計元素，它允許 Kafka 處理大規模消息流、實現高吞吐量、提供容錯性、保證消息順序性以及支持多個並行消費者。通過有效地使用分區，Kafka 能夠滿足各種不同應用場景的需求，從日誌處理到事件驅動架構和流數據處理。


*為什麼要有group
1. 並行處理和負載均衡：消費者組允許多個消費者一同處理同一個主題中的消息。每個消費者組內的消費者可以訂閱不同的分區，以實現並行處理。這有助於提高消息處理的吞吐量和效率，同時允許多個消費者同時處理消息，應對高流量負載。

2. 高可用性：消費者組支援容錯性和高可用性。如果一個消費者失敗，消費者組中的其他消費者仍然可以繼續工作，確保消息不會丟失。這有助於確保消費者應用程式的可用性，即使有一些消費者失效也能繼續運作。

3. 消息分發和負載均衡：Kafka 會根據分區的數量和消費者組的訂閱關係自動分發消息給消費者。這確保了消息均勻分佈到各個消費者，以實現負載均衡。當新的消費者加入消費者組或現有消費者離開時，Kafka 也會自動進行再分配，以確保每個消費者的負載均衡。

4. 水平擴展：消費者組允許您水平擴展消費者應用程式。通過增加消費者的數量，您可以處理更多的消息和更高的負載，而不需要修改應用程式的代碼。這使得 Kafka 成為一個可擴展的消息處理平台。

5. 消息處理協調：消費者組內的消費者可以通過協調工具來管理消息處理的協調。協調工具通常用於追蹤每個分區的位移，以確保消息只被處理一次。這有助於避免重複處理消息的問題。

總之，消費者組是 Apache Kafka 中的一個關鍵概念，它允許多個消費者協同處理消息，實現並行處理、高可用性、負載均衡和水平擴展。消費者組的使用使得 Kafka 成為一個功能豐富且高效的消息處理平台，適用於各種不同的應用場景，包括日誌處理、事件驅動應用、流數據處理和更多。




